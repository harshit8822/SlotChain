<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SlotChain - Book Your Grooming Station</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; transition: all 0.3s ease; }
        .gradient-bg { background: linear-gradient(135deg, #ff8c00 0%, #ff6b35 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .crypto-glow { box-shadow: 0 0 20px rgba(255, 140, 0, 0.3); }
        .nft-glow { box-shadow: 0 0 20px rgba(139, 92, 246, 0.4); }
        .secure-glow { box-shadow: 0 0 20px rgba(34, 197, 94, 0.4); }
        .hbar-glossy { 
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            box-shadow: 
                0 12px 40px rgba(139, 92, 246, 0.5),
                inset 0 2px 0 rgba(255, 255, 255, 0.4),
                inset 0 -2px 0 rgba(0, 0, 0, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all 0.4s ease;
        }
        label:hover .hbar-glossy {
            background: linear-gradient(135deg, #a855f7 0%, #7c3aed 100%);
            box-shadow: 
                0 20px 60px rgba(139, 92, 246, 0.8),
                inset 0 2px 0 rgba(255, 255, 255, 0.5),
                inset 0 -2px 0 rgba(0, 0, 0, 0.2);
            transform: translateY(-4px) scale(1.1);
        }
        .dark .hbar-glossy {
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            box-shadow: 
                0 12px 40px rgba(124, 58, 237, 0.6),
                inset 0 2px 0 rgba(255, 255, 255, 0.3),
                inset 0 -2px 0 rgba(0, 0, 0, 0.25);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        .dark label:hover .hbar-glossy {
            background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
            box-shadow: 
                0 20px 60px rgba(124, 58, 237, 0.9),
                inset 0 2px 0 rgba(255, 255, 255, 0.4),
                inset 0 -2px 0 rgba(0, 0, 0, 0.3);
            transform: translateY(-4px) scale(1.1);
        }
        .card-glossy { 
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            box-shadow: 
                0 8px 32px rgba(5, 150, 105, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                inset 0 -1px 0 rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        .card-payment-option:hover .card-glossy {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 
                0 12px 40px rgba(5, 150, 105, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.4),
                inset 0 -1px 0 rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }
        .dark .card-glossy {
            background: linear-gradient(135deg, #047857 0%, #065f46 100%);
            box-shadow: 
                0 8px 32px rgba(4, 120, 87, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.25),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        .dark .card-payment-option:hover .card-glossy {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            box-shadow: 
                0 12px 40px rgba(4, 120, 87, 0.7),
                inset 0 1px 0 rgba(255, 255, 255, 0.35),
                inset 0 -1px 0 rgba(0, 0, 0, 0.25);
            transform: translateY(-2px);
        }
        .nft-shimmer { background: linear-gradient(45deg, #fbbf24 25%, #f59e0b 50%, #fbbf24 75%); background-size: 200% 100%; animation: shimmer 2s infinite; }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        .booking-slot { transition: all 0.2s ease; }
        .booking-slot:hover { background-color: #f3f4f6; }
        .booking-slot.selected { background-color: #ff8c00; color: white; }
        .notification { position: fixed; top: 20px; right: 20px; z-index: 1000; transform: translateX(100%); transition: transform 0.3s ease; opacity: 0; }
        .notification.show { transform: translateX(0); opacity: 1; }
        
        /* Dark Mode Styles */
        .dark { background-color: #0a0a0a; color: #ffffff; }
        .dark .bg-white { background-color: #1a1a1a; }
        .dark .bg-gray-50 { background-color: #0f0f0f; }
        .dark .bg-gray-100 { background-color: #2a2a2a; }
        .dark .text-gray-900 { color: #ffffff; }
        .dark .text-gray-700 { color: #d1d5db; }
        .dark .text-gray-600 { color: #9ca3af; }
        .dark .text-gray-500 { color: #6b7280; }
        .dark .border-gray-300 { border-color: #4b5563; }
        .dark .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.3); }
        .dark .shadow-sm { box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.4); }
        .dark .booking-slot:hover { background-color: #374151; }
        .dark .nft-shimmer { background: linear-gradient(45deg, #374151 25%, #4b5563 50%, #374151 75%); background-size: 200% 100%; }
        .dark input, .dark select { background-color: #2a2a2a; color: #ffffff; border-color: #6b7280; }
        .dark #citySelect, .dark #radiusSelect, .dark #locationInput { background-color: #2a2a2a; color: #ffffff; border-color: #6b7280; }
        .dark input::placeholder { color: #6b7280; }
        .dark .chatbot-window { background: #1a1a1a; }
        .dark .chatbot-input-area { border-color: #4b5563; }
        
        /* Dark mode setup station styles */
        .dark .bg-gradient-to-r.from-orange-100.to-yellow-100 { 
            background: linear-gradient(to right, #7c2d12, #a16207); 
            border-color: #ea580c; 
        }
        .dark .bg-gradient-to-r.from-orange-100.to-yellow-100 .text-gray-900 { color: #ffffff; }
        .dark .bg-gradient-to-r.from-orange-100.to-yellow-100 .text-gray-800 { color: #f3f4f6; }
        
        /* Chatbot Styles */
        .chatbot-container { position: fixed; bottom: 20px; right: 20px; z-index: 1000; }
        .chatbot-toggle { width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #ff8c00 0%, #ff6b35 100%); color: white; border: none; cursor: pointer; box-shadow: 0 4px 12px rgba(255, 140, 0, 0.3); transition: all 0.3s ease; }
        .chatbot-toggle:hover { transform: scale(1.1); }
        .chatbot-window { position: absolute; bottom: 80px; right: 0; width: 350px; height: 500px; background: white; border-radius: 12px; box-shadow: 0 20px 40px rgba(0,0,0,0.15); display: none; flex-direction: column; }
        .dark .chatbot-window { background: #2d2d2d; }
        .chatbot-header { padding: 16px; background: linear-gradient(135deg, #ff8c00 0%, #ff6b35 100%); color: white; border-radius: 12px 12px 0 0; }
        .chatbot-messages { flex: 1; padding: 16px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; }
        .chatbot-input-area { padding: 16px; border-top: 1px solid #e5e7eb; }
        .dark .chatbot-input-area { border-color: #4b5563; }
        .message { max-width: 80%; padding: 8px 12px; border-radius: 12px; }
        .message.user { background: #ff8c00; color: white; align-self: flex-end; }
        .message.bot { background: #f3f4f6; color: #374151; align-self: flex-start; }
        .dark .message.bot { background: #374151; color: #d1d5db; }
        .typing-indicator { display: none; align-self: flex-start; padding: 8px 12px; background: #f3f4f6; border-radius: 12px; }
        .dark .typing-indicator { background: #374151; }
        .typing-dots { display: flex; gap: 4px; }
        .typing-dot { width: 6px; height: 6px; background: #9ca3af; border-radius: 50%; animation: typing 1.4s infinite; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-10px); } }
        
        /* Image Carousel Styles */
        .image-carousel {
            position: relative;
            width: 100%;
            height: 200px;
            overflow: hidden;
            border-radius: 12px 12px 0 0;
        }
        .carousel-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .carousel-image.active {
            opacity: 1;
        }
        .carousel-controls {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease;
        }
        .carousel-controls:hover {
            background: rgba(0, 0, 0, 0.7);
        }
        .carousel-prev {
            left: 10px;
        }
        .carousel-next {
            right: 10px;
        }
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Theme Toggle */
        .theme-toggle { position: relative; width: 50px; height: 24px; background: #d1d5db; border-radius: 12px; cursor: pointer; transition: background 0.3s ease; }
        .theme-toggle.dark { background: #ff8c00; }
        .theme-toggle-slider { position: absolute; top: 2px; left: 2px; width: 20px; height: 20px; background: white; border-radius: 50%; transition: transform 0.3s ease; }
        .theme-toggle.dark .theme-toggle-slider { transform: translateX(26px); }
    </style>
</head>
<body class="bg-gray-50 dark">
    <!-- Notification System -->
    <div id="notification" class="notification bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg">
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <i class="fas fa-check-circle mr-2"></i>
                <span id="notificationText">Booking confirmed!</span>
            </div>
            <button id="closeNotification" class="ml-4 text-white hover:text-gray-200 transition-colors">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <i class="fas fa-cut text-2xl text-orange-500 mr-2"></i>
                        <span class="text-2xl font-bold text-gray-900">SlotChain</span>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="setupStationBtn" class="text-orange-500 hover:text-orange-600 px-3 py-2 rounded-md text-sm font-medium flex items-center">
                        <i class="fas fa-store mr-2"></i>
                        Setup Station
                    </button>
                    <button id="loginBtn" class="text-gray-700 hover:text-orange-500 px-3 py-2 rounded-md text-sm font-medium">Login</button>
                    <button id="signupBtn" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-md text-sm font-medium">Sign Up</button>
                    <div id="userMenu" class="hidden flex items-center space-x-4">
                        <span id="userName" class="text-gray-700 font-medium"></span>
                        <button id="dashboardBtn" class="text-orange-500 hover:text-orange-600">Dashboard</button>
                        <button id="logoutBtn" class="text-gray-500 hover:text-gray-700">Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div id="mainContent">
        <!-- Hero Section -->
        <section class="relative text-white py-20 overflow-hidden">
            <!-- Background Image -->
            <div class="absolute inset-0">
                <img src="https://images.unsplash.com/photo-1585747860715-2ba37e788b70?w=1920&h=1080&fit=crop" 
                     alt="Modern Indian barber shop interior" 
                     class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-black bg-opacity-50"></div>
            </div>
            
            <!-- Content Overlay -->
            <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h1 class="text-5xl font-bold mb-6">Your next haircut or makeover, just a click away</h1>
                <p class="text-xl mb-8 opacity-90">Secure blockchain-powered bookings with crypto payments and exclusive NFT rewards</p>
                <div class="flex justify-center">
                    <button id="bookNowBtn" class="bg-white text-orange-500 px-8 py-3 rounded-lg font-semibold hover:bg-gray-100 transition duration-300">Book Now</button>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section class="py-16 bg-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold text-gray-900 mb-4">Why Choose SlotChain?</h2>
                    <p class="text-gray-600 max-w-2xl mx-auto">Experience the future of grooming bookings with blockchain technology</p>
                </div>
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="text-center p-6 card-hover bg-gray-50 rounded-xl">
                        <div class="crypto-glow bg-orange-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-coins text-2xl text-orange-500"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-2">Crypto Payments</h3>
                        <p class="text-gray-600">Pay with Hedera HBAR or traditional cards</p>
                    </div>
                    <div class="text-center p-6 card-hover bg-gray-50 rounded-xl">
                        <div class="nft-glow bg-purple-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-gem text-2xl text-purple-600"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-2">NFT Rewards</h3>
                        <p class="text-gray-600">Earn exclusive collectible NFTs with each booking</p>
                    </div>
                    <div class="text-center p-6 card-hover bg-gray-50 rounded-xl">
                        <div class="secure-glow bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-shield-alt text-2xl text-green-600"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-2">Secure Booking</h3>
                        <p class="text-gray-600">Blockchain-secured appointments and data</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Network Section -->
        <section id="stationsSection" class="py-16 bg-gray-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold text-gray-900 mb-4">SlotChain Network</h2>
                    <p class="text-gray-600 max-w-2xl mx-auto">Discover grooming stations in your area or join our network as a station owner</p>
                </div>
                
                <!-- Location Controls -->
                <div class="bg-white rounded-xl shadow-sm p-6 mb-8">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                        <button id="useLocationBtn" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition duration-300 flex items-center justify-center">
                            <i class="fas fa-location-arrow mr-2"></i>
                            Use My Location
                        </button>
                        <div class="flex">
                            <input type="text" id="locationInput" placeholder="Enter city or address" class="flex-1 px-3 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-indigo-500 min-w-0">
                            <button id="searchLocationBtn" class="bg-gray-600 text-white px-4 py-2 rounded-r-md hover:bg-gray-700 transition duration-300 flex-shrink-0">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                        <select id="citySelect" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 min-w-0">
                            <option value="">Select a city</option>
                            <option value="Bengaluru, Karnataka">Bengaluru</option>
                            <option value="Mysuru, Karnataka">Mysuru</option>
                            <option value="Hubli, Karnataka">Hubli</option>
                            <option value="Dharwad, Karnataka">Dharwad</option>
                            <option value="Mangaluru, Karnataka">Mangaluru</option>
                            <option value="Belagavi, Karnataka">Belagavi</option>
                            <option value="Davangere, Karnataka">Davangere</option>
                            <option value="Ballari, Karnataka">Ballari</option>
                            <option value="Vijayapura, Karnataka">Vijayapura</option>
                            <option value="Shivamogga, Karnataka">Shivamogga</option>
                            <option value="Tumakuru, Karnataka">Tumakuru</option>
                            <option value="Raichur, Karnataka">Raichur</option>
                            <option value="Bidar, Karnataka">Bidar</option>
                            <option value="Hospet, Karnataka">Hospet</option>
                            <option value="Hassan, Karnataka">Hassan</option>
                            <option value="Gadag, Karnataka">Gadag</option>
                            <option value="Udupi, Karnataka">Udupi</option>
                            <option value="Kolar, Karnataka">Kolar</option>
                            <option value="Mandya, Karnataka">Mandya</option>
                            <option value="Chikkamagaluru, Karnataka">Chikkamagaluru</option>
                            <option value="Chitradurga, Karnataka">Chitradurga</option>
                        </select>
                        <button id="searchCityBtn" class="bg-orange-500 text-white px-4 py-2 rounded-md hover:bg-orange-600 transition duration-300 whitespace-nowrap">
                            Search City
                        </button>
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <label class="text-sm font-medium text-gray-700">Search Radius:</label>
                            <select id="radiusSelect" class="px-3 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="5000">5 km</option>
                                <option value="10000" selected>10 km</option>
                                <option value="25000">25 km</option>
                                <option value="50000">50 km</option>
                            </select>
                        </div>
                        <div id="locationStatus" class="hidden text-sm text-gray-600">
                            <i class="fas fa-map-marker-alt mr-1"></i>
                            <span id="currentLocation">Searching...</span>
                        </div>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="flex justify-center space-x-4 mb-8">
                    <button id="browseStationsBtn" class="bg-indigo-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-indigo-700 transition duration-300 flex items-center">
                        <i class="fas fa-search mr-2"></i>
                        Browse Stations
                    </button>
                    <button id="setupStationMainBtn" class="border-2 border-indigo-600 text-indigo-600 px-8 py-3 rounded-lg font-semibold hover:bg-indigo-600 hover:text-white transition duration-300 flex items-center">
                        <i class="fas fa-store mr-2"></i>
                        Setup Your Station
                    </button>
                </div>
                
                <!-- Loading State -->
                <div id="loadingStations" class="hidden text-center py-12">
                    <div class="loading-spinner mx-auto mb-4"></div>
                    <p class="text-gray-600">Finding grooming stations near you...</p>
                </div>
                
                <!-- Stations Display -->
                <div id="stationsList" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Stations will be populated here -->
                </div>
            </div>
        </section>
    </div>

    <!-- Auth Modal -->
    <div id="authModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 relative">
            <button id="closeAuthModal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                <i class="fas fa-times"></i>
            </button>
            
            <div class="text-center mb-6">
                <h3 id="authTitle" class="text-2xl font-bold text-gray-900">Welcome to SlotChain</h3>
                <p class="text-gray-600 mt-2">Join the future of grooming bookings</p>
            </div>
            
            <form id="authForm">
                <div id="nameField" class="hidden mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                    <input type="text" id="fullName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="email" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <input type="password" id="password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                </div>
                <button type="submit" id="authSubmit" class="w-full bg-indigo-600 text-white py-2 rounded-md hover:bg-indigo-700 transition duration-300">Sign In</button>
            </form>
            
            <div class="mt-4 text-center">
                <button id="authToggle" class="text-indigo-600 hover:text-indigo-800">Don't have an account? Sign up</button>
            </div>
        </div>
    </div>

    <!-- Booking Modal -->
    <div id="bookingModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white dark:bg-gray-800 rounded-xl p-8 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto relative">
            <button id="closeBookingModal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 z-10">
                <i class="fas fa-times text-xl"></i>
            </button>
            
            <div class="mb-6">
                <h3 class="text-2xl font-bold text-gray-900">Book Your Appointment</h3>
            </div>
            
            <div id="bookingStep1" class="booking-step">
                <h4 class="text-lg font-semibold mb-4">Select Service & Date</h4>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Service</label>
                    <select id="serviceSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="">Select a service</option>
                        <option value="haircut">Haircut</option>
                        <option value="beard-trim">Beard Trim</option>
                        <option value="full-service">Full Service</option>
                        <option value="styling">Hair Styling</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Date</label>
                    <input type="date" id="bookingDate" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Available Time Slots</label>
                    <div id="timeSlots" class="grid grid-cols-3 gap-2">
                        <!-- Time slots will be populated here -->
                    </div>
                </div>
                <button id="nextToPayment" class="w-full bg-indigo-600 text-white py-2 rounded-md hover:bg-indigo-700 transition duration-300 disabled:bg-gray-400" disabled>Continue to Payment</button>
            </div>
            
            <div id="bookingStep2" class="booking-step hidden">
                <h4 class="text-lg font-semibold mb-4">Payment & NFT Minting</h4>
                <div class="bg-gray-50 p-4 rounded-lg mb-6">
                    <div class="flex justify-between items-center mb-2">
                        <span>Service:</span>
                        <span id="selectedService" class="font-semibold"></span>
                    </div>
                    <div class="flex justify-between items-center mb-2">
                        <span>Date & Time:</span>
                        <span id="selectedDateTime" class="font-semibold"></span>
                    </div>
                    <div class="flex justify-between items-center text-lg font-bold">
                        <span>Total:</span>
                        <span id="totalAmount">$0</span>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h5 class="font-semibold mb-3">Payment Method</h5>
                    <div class="space-y-3">
                        <label class="flex items-center p-4 border-2 border-purple-400 rounded-xl cursor-pointer hover:bg-gradient-to-r hover:from-purple-50 hover:to-indigo-50 dark:hover:from-purple-900/30 dark:hover:to-indigo-900/30 hover:border-purple-500 dark:hover:border-purple-500 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105 bg-gradient-to-r from-purple-25 to-indigo-25">
                            <input type="radio" name="paymentMethod" value="hedera" class="mr-4">
                            <div class="hbar-glossy p-4 rounded-xl relative overflow-hidden">
                                <div class="absolute inset-0 bg-gradient-to-br from-purple-400 to-indigo-600 opacity-20"></div>
                                <div class="w-8 h-8 text-white relative z-10 flex items-center justify-center font-bold text-2xl">
                                    <div class="relative">
                                        <div class="text-white font-black text-2xl leading-none">H</div>
                                        <div class="absolute top-1/2 left-0 right-0 h-0.5 bg-white transform -translate-y-1"></div>
                                        <div class="absolute top-1/2 left-0 right-0 h-0.5 bg-white transform translate-y-1"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="ml-4 flex-1">
                                <div class="font-bold text-lg text-gray-900 dark:text-white">
                                    Hedera HBAR
                                </div>
                                <div class="text-sm text-purple-800 dark:text-purple-300 font-semibold">Pay with cryptocurrency + Get exclusive NFT reward</div>
                                <div class="text-xs text-purple-700 dark:text-purple-400 mt-1 font-medium">✨ Earn collectible tokens with every booking</div>
                            </div>
                        </label>
                        <label class="card-payment-option flex items-center p-4 border-2 border-emerald-500 rounded-xl cursor-pointer hover:bg-gradient-to-r hover:from-emerald-50 hover:to-green-50 dark:hover:from-emerald-900/30 dark:hover:to-green-900/30 hover:border-emerald-600 dark:hover:border-emerald-400 transition-all duration-300 shadow-lg hover:shadow-xl bg-gradient-to-r from-emerald-50/50 to-green-50/50 dark:bg-gradient-to-r dark:from-emerald-900/20 dark:to-green-900/20">
                            <input type="radio" name="paymentMethod" value="card" class="mr-4">
                            <div class="card-glossy p-4 rounded-xl">
                                <i class="fas fa-credit-card text-white text-xl"></i>
                            </div>
                            <div class="ml-4 flex-1">
                                <div class="font-bold text-lg text-emerald-900 dark:text-emerald-100">Credit/Debit Card</div>
                                <div class="text-sm text-emerald-800 dark:text-emerald-200 font-semibold">Traditional payment method</div>

                            </div>
                        </label>
                    </div>
                </div>
                
                <div id="nftPreview" class="hidden mb-6 p-6 bg-gradient-to-r from-purple-600 to-indigo-600 rounded-lg border-2 border-purple-400 shadow-lg">
                    <h5 class="font-bold mb-3 flex items-center text-white text-lg">
                        <i class="fas fa-gem text-yellow-300 mr-2 text-xl"></i>
                        Your Exclusive NFT Reward
                    </h5>
                    <div class="flex items-center space-x-4">
                        <div class="w-20 h-20 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-lg flex items-center justify-center nft-shimmer shadow-lg border-2 border-yellow-300">
                            <i class="fas fa-cut text-white text-2xl"></i>
                        </div>
                        <div>
                            <div class="font-bold text-white text-lg">SlotChain Grooming NFT #<span id="nftNumber">001</span></div>
                            <div class="text-purple-100 font-medium">Collectible grooming experience token</div>
                            <div class="text-yellow-300 text-sm font-semibold mt-1">✨ Limited Edition ✨</div>
                        </div>
                    </div>
                </div>
                
                <div class="flex space-x-4">
                    <button id="backToBooking" class="flex-1 border border-gray-300 text-gray-700 py-2 rounded-md hover:bg-gray-50 transition duration-300">Back</button>
                    <button id="confirmBooking" class="flex-1 bg-indigo-600 text-white py-2 rounded-md hover:bg-indigo-700 transition duration-300">Confirm Booking</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Station Setup Modal -->
    <div id="stationSetupModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto relative">
            <button id="closeStationSetupModal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 z-10">
                <i class="fas fa-times text-xl"></i>
            </button>
            
            <div class="mb-6">
                <h3 class="text-2xl font-bold text-gray-900">Setup Your Grooming Station</h3>
            </div>
            
            <div class="mb-6">
                <div class="bg-gradient-to-r from-orange-100 to-yellow-100 p-6 rounded-lg mb-6 border border-orange-200">
                    <h4 class="text-lg font-semibold mb-2 flex items-center text-gray-900">
                        <i class="fas fa-store text-orange-600 mr-2"></i>
                        Join the SlotChain Network
                    </h4>
                    <p class="text-gray-800 font-medium">List your grooming station on SlotChain and start accepting crypto payments with automatic NFT rewards for your customers!</p>
                </div>
                
                <form id="stationSetupForm">
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Station Name</label>
                            <input type="text" id="stationName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="e.g., Downtown Cuts" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Owner Name</label>
                            <input type="text" id="ownerName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Your full name" required>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Address</label>
                        <input type="text" id="stationAddress" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="123 Main St, City, State" required>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                            <input type="tel" id="stationPhone" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="(555) 123-4567" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                            <input type="email" id="stationEmail" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="contact@yourstation.com" required>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Services Offered</label>
                        <div class="grid grid-cols-2 gap-2">
                            <label class="flex items-center">
                                <input type="checkbox" value="haircut" class="mr-2 service-checkbox">
                                <span>Haircuts</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" value="beard-trim" class="mr-2 service-checkbox">
                                <span>Beard Trimming</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" value="styling" class="mr-2 service-checkbox">
                                <span>Hair Styling</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" value="full-service" class="mr-2 service-checkbox">
                                <span>Full Service</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Station Features</label>
                        <div class="grid grid-cols-2 gap-2">
                            <label class="flex items-center">
                                <input type="checkbox" value="wifi" class="mr-2 feature-checkbox">
                                <span>WiFi</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" value="parking" class="mr-2 feature-checkbox">
                                <span>Parking Available</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" value="premium-products" class="mr-2 feature-checkbox">
                                <span>Premium Products</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" value="massage-chairs" class="mr-2 feature-checkbox">
                                <span>Massage Chairs</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Hedera HBAR Wallet Address</label>
                        <input type="text" id="walletAddress" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="0.0.123456 (for receiving crypto payments)" required>
                        <p class="text-sm text-gray-500 mt-1">This is where you'll receive HBAR payments from customers</p>
                    </div>
                    
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
                        <div class="flex items-start">
                            <i class="fas fa-info-circle text-yellow-600 mr-2 mt-1"></i>
                            <div>
                                <h5 class="font-semibold text-yellow-800">Setup Process</h5>
                                <p class="text-sm text-yellow-700">After submitting, our team will review your application and contact you within 2-3 business days to complete the onboarding process.</p>
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="w-full bg-orange-500 text-white py-3 rounded-md hover:bg-orange-600 transition duration-300 font-semibold">
                        Submit Station Application
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="hidden bg-gray-50 dark min-h-screen">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="mb-8">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900">Your Dashboard</h1>
                        <p class="text-gray-600">Manage your bookings and view your NFT collection</p>
                    </div>
                    <button onclick="showMainContent()" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-md text-sm font-medium flex items-center">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Back to Home
                    </button>
                </div>
            </div>
            
            <div class="grid lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-xl shadow-sm p-6 mb-8">
                        <h2 class="text-xl font-semibold mb-4 text-gray-900 flex items-center">
                            <i class="fas fa-calendar-check text-orange-500 mr-2"></i>
                            Upcoming Appointments
                        </h2>
                        <div id="upcomingBookings" class="space-y-4">
                            <!-- Bookings will be populated here -->
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h2 class="text-xl font-semibold mb-4 text-gray-900 flex items-center">
                            <i class="fas fa-history text-indigo-600 mr-2"></i>
                            Booking History
                        </h2>
                        <div id="bookingHistory" class="space-y-4">
                            <!-- History will be populated here -->
                        </div>
                    </div>
                </div>
                
                <div>
                    <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                        <h2 class="text-xl font-semibold mb-4 flex items-center text-gray-900">
                            <i class="fas fa-gem text-purple-600 mr-2"></i>
                            Your NFT Collection
                        </h2>
                        <div id="nftCollection" class="grid grid-cols-2 gap-4">
                            <!-- NFTs will be populated here -->
                        </div>
                    </div>
                    

                </div>
            </div>
        </div>
    </div>

    <!-- Credits Section -->
    <footer class="bg-gray-900 text-white py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <div class="text-lg font-bold text-orange-400 mb-2" style="text-shadow: 0 0 10px rgba(255, 140, 0, 0.6), 0 0 20px rgba(255, 140, 0, 0.4), 0 0 30px rgba(255, 140, 0, 0.2);">
                    Team Hat
                </div>
                <div class="text-sm text-gray-300" style="text-shadow: 0 0 10px rgba(255, 140, 0, 0.6), 0 0 20px rgba(255, 140, 0, 0.4), 0 0 30px rgba(255, 140, 0, 0.2);">
                    Created by Harshit, Anshuman & Thushar
                </div>
            </div>
        </div>
    </footer>

    <!-- Chatbot -->
    <div class="chatbot-container">
        <div id="chatbotWindow" class="chatbot-window">
            <div class="chatbot-header">
                <div class="flex justify-between items-center">
                    <div>
                        <h4 class="font-semibold">SlotChain Assistant</h4>
                        <p class="text-sm opacity-90">Ask me anything about bookings!</p>
                    </div>
                    <button id="closeChatbot" class="text-white hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div id="chatbotMessages" class="chatbot-messages">
                <div class="message bot">
                    Hi! I'm your SlotChain assistant. I can help you with booking questions, payment info, or anything about our grooming stations. How can I help you today?
                </div>
            </div>
            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
            <div class="chatbot-input-area">
                <div class="flex space-x-2">
                    <input type="text" id="chatbotInput" placeholder="Type your message..." class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <button id="sendMessage" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition duration-300">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
        <button id="chatbotToggle" class="chatbot-toggle">
            <i class="fas fa-comments text-xl"></i>
        </button>
    </div>

    <script>
        // Application State
        let currentUser = null;
        let selectedStation = null;
        let selectedSlot = null;
        let bookings = JSON.parse(localStorage.getItem('slotchain_bookings') || '[]');
        let nftCollection = JSON.parse(localStorage.getItem('slotchain_nfts') || '[]');

        let chatbotOpen = false;
        let map = null;
        let service = null;
        let userLocation = null;
        let groomingStations = [];
        let stationCarousels = {};
        
        // Perplexity API Configuration
        const PERPLEXITY_API_KEY = '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';
        const PERPLEXITY_API_URL = 'https://api.perplexity.ai/chat/completions';

        // Time slots for booking
        const timeSlots = [
            "09:00", "09:30", "10:00", "10:30", "11:00", "11:30",
            "12:00", "12:30", "13:00", "13:30", "14:00", "14:30",
            "15:00", "15:30", "16:00", "16:30", "17:00", "17:30"
        ];

        // Leaflet Map initialization
        function initMap() {
            try {
                // Initialize Leaflet map (hidden, used for geocoding)
                const mapDiv = document.createElement('div');
                mapDiv.style.display = 'none';
                document.body.appendChild(mapDiv);
                
                map = L.map(mapDiv).setView([12.9716, 77.5946], 13); // Default to Bengaluru
                
                // Add OpenStreetMap tiles
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors'
                }).addTo(map);
                
                // Try to get user's location
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            userLocation = {
                                lat: position.coords.latitude,
                                lng: position.coords.longitude
                            };
                            searchNearbyStations();
                        },
                        () => {
                            // If geolocation fails, show demo stations
                            showDemoStations();
                        }
                    );
                } else {
                    showDemoStations();
                }
            } catch (error) {
                // If Leaflet fails to load, show demo stations
                console.log('Leaflet not available, showing demo stations');
                showDemoStations();
            }
        }
        
        // Initialize demo stations on page load
        window.addEventListener('load', function() {
            initMap();
            initializeDummyStations();
        });
        
        // Initialize dummy stations with setup data
        function initializeDummyStations() {
            const dummyStations = [
                {
                    id: 'station_1',
                    stationName: 'Royal Cuts & Grooming',
                    ownerName: 'Rajesh Kumar',
                    address: '123 MG Road, Koramangala, Bengaluru, Karnataka',
                    phone: '(080) 123-4567',
                    email: 'contact@royalcuts.com',
                    walletAddress: '0.0.123456',
                    services: ['haircut', 'beard-trim', 'styling', 'full-service'],
                    features: ['wifi', 'parking', 'premium-products', 'massage-chairs'],
                    rating: 4.8,
                    user_ratings_total: 156,
                    price_level: 3,
                    photos: [
                        'https://images.unsplash.com/photo-1585747860715-2ba37e788b70?w=400&h=300&fit=crop',
                        'https://images.unsplash.com/photo-1503951914875-452162b0f3f1?w=400&h=300&fit=crop'
                    ],
                    reviews: [
                        { text: "Excellent service and great attention to detail. The barber really knew what he was doing!", author_name: "Arjun Patel" },
                        { text: "Clean shop, friendly staff, and reasonable prices. Will definitely be back!", author_name: "Vikram Singh" }
                    ],
                    opening_hours: { open_now: true },
                    submittedAt: '2024-01-15T10:00:00Z',
                    status: 'approved'
                },
                {
                    id: 'station_2',
                    stationName: 'Mysore Palace Salon',
                    ownerName: 'Priya Sharma',
                    address: '456 Brigade Road, Indiranagar, Bengaluru, Karnataka',
                    phone: '(080) 234-5678',
                    email: 'info@mysorepalace.com',
                    walletAddress: '0.0.234567',
                    services: ['haircut', 'styling', 'full-service'],
                    features: ['wifi', 'premium-products', 'parking'],
                    rating: 4.6,
                    user_ratings_total: 89,
                    price_level: 2,
                    photos: [
                        'https://images.unsplash.com/photo-1621605815971-fbc98d665033?w=400&h=300&fit=crop',
                        'https://images.unsplash.com/photo-1560066984-138dadb4c035?w=400&h=300&fit=crop'
                    ],
                    reviews: [
                        { text: "Beautiful salon with traditional touch. Great styling services!", author_name: "Meera Reddy" },
                        { text: "Professional staff and excellent ambiance. Highly recommended!", author_name: "Kavya Nair" }
                    ],
                    opening_hours: { open_now: true },
                    submittedAt: '2024-01-20T14:30:00Z',
                    status: 'approved'
                },
                {
                    id: 'station_3',
                    stationName: 'Karnataka Kings Barber',
                    ownerName: 'Suresh Gowda',
                    address: '789 Commercial Street, Whitefield, Bengaluru, Karnataka',
                    phone: '(080) 345-6789',
                    email: 'kings@karnatakabarber.com',
                    walletAddress: '0.0.345678',
                    services: ['haircut', 'beard-trim', 'full-service'],
                    features: ['wifi', 'massage-chairs'],
                    rating: 4.4,
                    user_ratings_total: 67,
                    price_level: 2,
                    photos: [
                        'https://images.unsplash.com/photo-1599351431202-1e0f0137899a?w=400&h=300&fit=crop',
                        'https://images.unsplash.com/photo-1634449571010-02389ed0f9b0?w=400&h=300&fit=crop'
                    ],
                    reviews: [
                        { text: "Traditional barber shop with modern facilities. Great beard trimming!", author_name: "Ravi Kumar" },
                        { text: "Friendly service and good prices. Perfect for regular haircuts.", author_name: "Anil Joshi" }
                    ],
                    opening_hours: { open_now: false },
                    submittedAt: '2024-01-25T09:15:00Z',
                    status: 'approved'
                }
            ];
            
            // Store dummy stations
            localStorage.setItem('slotchain_registered_stations', JSON.stringify(dummyStations));
            groomingStations = dummyStations;
        }
        
        // Show available stations on page load
        function showAvailableStations() {
            const registeredStations = JSON.parse(localStorage.getItem('slotchain_registered_stations') || '[]');
            const stationApplications = JSON.parse(localStorage.getItem('slotchain_station_applications') || '[]');
            
            // Combine approved applications with dummy stations
            const approvedApplications = stationApplications.filter(app => app.status === 'approved');
            const allStations = [...registeredStations, ...approvedApplications];
            
            if (allStations.length === 0) {
                document.getElementById('stationsList').innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-store text-6xl text-gray-300 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-600 mb-2">No Stations Available Yet</h3>
                        <p class="text-gray-500">Check back soon for new grooming stations!</p>
                    </div>
                `;
            } else {
                groomingStations = allStations;
                displayStations();
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            checkAuthState();

        });

        function initializeApp() {
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('bookingDate').min = today;
            document.getElementById('bookingDate').value = today;
        }

        function setupEventListeners() {
            // Auth buttons
            document.getElementById('loginBtn').addEventListener('click', () => showAuthModal('login'));
            document.getElementById('signupBtn').addEventListener('click', () => showAuthModal('signup'));
            document.getElementById('logoutBtn').addEventListener('click', logout);
            document.getElementById('dashboardBtn').addEventListener('click', showDashboard);
            

            
            // Location controls
            document.getElementById('useLocationBtn').addEventListener('click', useCurrentLocation);
            document.getElementById('searchLocationBtn').addEventListener('click', searchByLocation);
            document.getElementById('searchCityBtn').addEventListener('click', searchByCity);
            document.getElementById('citySelect').addEventListener('change', searchByCity);
            document.getElementById('locationInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') searchByLocation();
            });
            document.getElementById('radiusSelect').addEventListener('change', searchNearbyStations);
            
            // Station setup
            document.getElementById('setupStationBtn').addEventListener('click', showStationSetupModal);
            document.getElementById('closeStationSetupModal').addEventListener('click', hideStationSetupModal);
            document.getElementById('stationSetupForm').addEventListener('submit', handleStationSetup);
            
            // Browse stations
            document.getElementById('browseStationsBtn').addEventListener('click', showAvailableStations);
            
            // Notification close button
            document.getElementById('closeNotification').addEventListener('click', closeNotification);
            
            // Chatbot
            document.getElementById('chatbotToggle').addEventListener('click', toggleChatbot);
            document.getElementById('closeChatbot').addEventListener('click', closeChatbot);
            document.getElementById('sendMessage').addEventListener('click', sendChatMessage);
            document.getElementById('chatbotInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendChatMessage();
            });
            
            // Modal controls
            document.getElementById('closeAuthModal').addEventListener('click', hideAuthModal);
            document.getElementById('closeBookingModal').addEventListener('click', hideBookingModal);
            document.getElementById('authToggle').addEventListener('click', toggleAuthMode);
            
            // Auth form
            document.getElementById('authForm').addEventListener('submit', handleAuth);
            
            // Booking flow
            document.getElementById('bookNowBtn').addEventListener('click', () => {
                document.getElementById('stationsSection').scrollIntoView({ behavior: 'smooth' });
            });
            
            // Setup station button
            document.getElementById('setupStationMainBtn').addEventListener('click', showStationSetupModal);
            
            // Booking modal
            document.getElementById('serviceSelect').addEventListener('change', updateBookingDetails);
            document.getElementById('bookingDate').addEventListener('change', loadTimeSlots);
            document.getElementById('nextToPayment').addEventListener('click', showPaymentStep);
            document.getElementById('backToBooking').addEventListener('click', showBookingStep);
            document.getElementById('confirmBooking').addEventListener('click', confirmBooking);
            
            // Payment method selection
            document.querySelectorAll('input[name="paymentMethod"]').forEach(radio => {
                radio.addEventListener('change', handlePaymentMethodChange);
            });
            
            // Load time slots on page load
            loadTimeSlots();
        }

        function showAuthModal(mode) {
            const modal = document.getElementById('authModal');
            const title = document.getElementById('authTitle');
            const nameField = document.getElementById('nameField');
            const submitBtn = document.getElementById('authSubmit');
            const toggle = document.getElementById('authToggle');
            
            if (mode === 'signup') {
                title.textContent = 'Create Your Account';
                nameField.classList.remove('hidden');
                submitBtn.textContent = 'Sign Up';
                toggle.textContent = 'Already have an account? Sign in';
            } else {
                title.textContent = 'Welcome Back';
                nameField.classList.add('hidden');
                submitBtn.textContent = 'Sign In';
                toggle.textContent = "Don't have an account? Sign up";
            }
            
            modal.classList.remove('hidden');
            modal.dataset.mode = mode;
        }

        function hideAuthModal() {
            document.getElementById('authModal').classList.add('hidden');
            document.getElementById('authForm').reset();
        }

        function toggleAuthMode() {
            const currentMode = document.getElementById('authModal').dataset.mode;
            showAuthModal(currentMode === 'login' ? 'signup' : 'login');
        }

        function handleAuth(e) {
            e.preventDefault();
            const mode = document.getElementById('authModal').dataset.mode;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const fullName = document.getElementById('fullName').value;
            
            // Simulate authentication
            if (mode === 'signup') {
                currentUser = {
                    id: Date.now(),
                    name: fullName,
                    email: email,
                    joinDate: new Date().toISOString()
                };
                localStorage.setItem('slotchain_user', JSON.stringify(currentUser));
                showNotification('Account created successfully!');
            } else {
                // For demo, accept any email/password
                currentUser = {
                    id: 1,
                    name: email.split('@')[0],
                    email: email,
                    joinDate: '2024-01-01'
                };
                localStorage.setItem('slotchain_user', JSON.stringify(currentUser));
                showNotification('Welcome back!');
            }
            
            updateAuthUI();
            hideAuthModal();
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('slotchain_user');
            updateAuthUI();
            showMainContent();
            showNotification('Logged out successfully');
        }

        function checkAuthState() {
            const savedUser = localStorage.getItem('slotchain_user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                updateAuthUI();
            }
        }

        function updateAuthUI() {
            const loginBtn = document.getElementById('loginBtn');
            const signupBtn = document.getElementById('signupBtn');
            const userMenu = document.getElementById('userMenu');
            const userName = document.getElementById('userName');
            
            if (currentUser) {
                loginBtn.classList.add('hidden');
                signupBtn.classList.add('hidden');
                userMenu.classList.remove('hidden');
                userName.textContent = currentUser.name;
            } else {
                loginBtn.classList.remove('hidden');
                signupBtn.classList.remove('hidden');
                userMenu.classList.add('hidden');
            }
        }

        // Search for nearby grooming stations using Nominatim API
        async function searchNearbyStations() {
            if (!userLocation) {
                showDemoStations();
                return;
            }
            
            showLoadingStations();
            
            try {
                // Use Overpass API to find nearby grooming stations
                const radius = parseInt(document.getElementById('radiusSelect').value);
                const overpassQuery = `
                    [out:json][timeout:25];
                    (
                        node["shop"="hairdresser"](around:${radius},${userLocation.lat},${userLocation.lng});
                        node["shop"="barber"](around:${radius},${userLocation.lat},${userLocation.lng});
                        node["amenity"="barber"](around:${radius},${userLocation.lat},${userLocation.lng});
                        way["shop"="hairdresser"](around:${radius},${userLocation.lat},${userLocation.lng});
                        way["shop"="barber"](around:${radius},${userLocation.lat},${userLocation.lng});
                        way["amenity"="barber"](around:${radius},${userLocation.lat},${userLocation.lng});
                    );
                    out center meta;
                `;
                
                const response = await fetch('https://overpass-api.de/api/interpreter', {
                    method: 'POST',
                    body: overpassQuery
                });
                
                const data = await response.json();
                
                if (data.elements && data.elements.length > 0) {
                    groomingStations = data.elements.slice(0, 12).map((element, index) => {
                        const lat = element.lat || element.center?.lat;
                        const lon = element.lon || element.center?.lon;
                        
                        return {
                            id: element.id || index,
                            name: element.tags?.name || `Grooming Station ${index + 1}`,
                            location: element.tags?.['addr:street'] || `Near ${userLocation.lat.toFixed(3)}, ${userLocation.lng.toFixed(3)}`,
                            rating: (Math.random() * 1.5 + 3.5).toFixed(1),
                            user_ratings_total: Math.floor(Math.random() * 200) + 50,
                            price_level: Math.floor(Math.random() * 3) + 1,
                            photos: getRandomPhotos(),
                            phone: element.tags?.phone || generateRandomPhone(),
                            website: element.tags?.website || `https://${element.tags?.name?.toLowerCase().replace(/[^a-z0-9]/g, '') || 'grooming'}.com`,
                            opening_hours: { open_now: Math.random() > 0.3 },
                            reviews: generateDemoReviews(),
                            services: ["haircut", "beard-trim", "styling"],
                            features: getRandomFeatures(),
                            coordinates: { lat, lon }
                        };
                    });
                    
                    hideLoadingStations();
                    displayStations();
                } else {
                    // Fallback to demo stations if no results
                    showDemoStations();
                }
            } catch (error) {
                console.log('Overpass API error, showing demo stations');
                showDemoStations();
            }
        }
        
        // Show demo stations when API is not available
        function showDemoStations() {
            const currentCity = document.getElementById('citySelect').value || 
                              document.getElementById('locationInput').value || 
                              'Bengaluru, Karnataka';
            
            groomingStations = generateDemoStations(currentCity);
            hideLoadingStations();
            displayStations();
        }
        
        // Generate demo stations for selected city
        function generateDemoStations(city) {
            const stationNames = [
                'Royal Cuts & Grooming', 'Mysore Palace Salon', 'Karnataka Kings Barber', 
                'Bangalore Style Studio', 'Heritage Grooming Lounge', 'The Maharaja\'s Chair',
                'Elite Gents Salon', 'Classic Kannada Cuts', 'Modern Mysuru Barbers',
                'The Grooming Rajya', 'Precision Hair Studio', 'Namma Barber Shop'
            ];
            
            const neighborhoods = getNeighborhoods(city);
            const demoPhotos = [
                'https://images.unsplash.com/photo-1585747860715-2ba37e788b70?w=400&h=300&fit=crop',
                'https://images.unsplash.com/photo-1503951914875-452162b0f3f1?w=400&h=300&fit=crop',
                'https://images.unsplash.com/photo-1621605815971-fbc98d665033?w=400&h=300&fit=crop',
                'https://images.unsplash.com/photo-1560066984-138dadb4c035?w=400&h=300&fit=crop',
                'https://images.unsplash.com/photo-1599351431202-1e0f0137899a?w=400&h=300&fit=crop',
                'https://images.unsplash.com/photo-1634449571010-02389ed0f9b0?w=400&h=300&fit=crop',
                'https://images.unsplash.com/photo-1605497788044-5a32c7078486?w=400&h=300&fit=crop'
            ];
            
            return stationNames.map((name, index) => ({
                id: `demo_${index}`,
                name: name,
                location: `${neighborhoods[index % neighborhoods.length]}, ${city}`,
                rating: (Math.random() * 1.5 + 3.5).toFixed(1),
                user_ratings_total: Math.floor(Math.random() * 200) + 50,
                price_level: Math.floor(Math.random() * 3) + 1,
                photos: demoPhotos.slice(0, Math.floor(Math.random() * 3) + 2).map(url => ({ getUrl: () => url })),
                place_id: `demo_${index}`,
                phone: `(${Math.floor(Math.random() * 900) + 100}) ${Math.floor(Math.random() * 900) + 100}-${Math.floor(Math.random() * 9000) + 1000}`,
                website: `https://${name.toLowerCase().replace(/[^a-z0-9]/g, '')}.com`,
                reviews: generateDemoReviews(),
                services: ["haircut", "beard-trim", "styling"],
                features: getRandomFeatures(),
                opening_hours: { open_now: Math.random() > 0.3 }
            }));
        }
        
        // Get neighborhoods for different cities
        function getNeighborhoods(city) {
            const cityNeighborhoods = {
                'Bengaluru, Karnataka': ['Koramangala', 'Indiranagar', 'Whitefield', 'Electronic City', 'Jayanagar', 'Malleshwaram', 'HSR Layout', 'BTM Layout'],
                'Mysuru, Karnataka': ['Saraswathipuram', 'Kuvempunagar', 'Vijayanagar', 'Gokulam', 'Hebbal', 'Nazarbad', 'Chamundipuram', 'Bogadi'],
                'Hubli, Karnataka': ['Vidyanagar', 'Keshwapur', 'Gokul Road', 'Deshpande Nagar', 'Unkal', 'Rayapur', 'Navanagar', 'Old Hubli'],
                'Dharwad, Karnataka': ['Saptapur', 'Vidyagiri', 'Navalur', 'Kelgeri', 'Malmaddi', 'Hosur', 'Jubilee Circle', 'Lakmanahalli'],
                'Mangaluru, Karnataka': ['Kadri', 'Kankanady', 'Falnir', 'Bejai', 'Pandeshwar', 'Balmatta', 'Kodialbail', 'Lalbagh'],
                'Belagavi, Karnataka': ['Tilakwadi', 'Camp', 'Shahapur', 'Hindwadi', 'Vadgaon', 'Angol', 'Mahantesh Nagar', 'Udyambag'],
                'Davangere, Karnataka': ['PJ Extension', 'Shivaji Nagar', 'Vidyanagar', 'Shamanur', 'Lokikere', 'Bapuji Nagar', 'Anjaneya Nagar', 'Nittuvalli'],
                'Ballari, Karnataka': ['Cantonment', 'Gandhi Nagar', 'Cowl Bazaar', 'Parvathi Nagar', 'Ravi Nagar', 'Jeevan Nagar', 'Nehru Nagar', 'Vijayanagar'],
                'Vijayapura, Karnataka': ['Station Road', 'MG Road', 'Azad Road', 'Solapur Road', 'Tikota', 'Minchnal', 'Sindagi Road', 'Almatti Road'],
                'Shivamogga, Karnataka': ['Kuvempu Nagar', 'Vidyanagar', 'Gandhi Bazaar', 'Gopala', 'Shankara', 'Vinoba Nagar', 'Tunga Nagar', 'Nehru Nagar'],
                'Tumakuru, Karnataka': ['Kyathasandra', 'Vasavi Nagar', 'Sira Gate', 'Madhugiri Road', 'Kunigal Road', 'Gubbi Cross', 'Tiptur Road', 'Pavagada Road'],
                'Raichur, Karnataka': ['Station Road', 'Gandhi Chowk', 'Jawahar Nagar', 'Shivaji Nagar', 'Nehru Nagar', 'Ambedkar Nagar', 'Sindhanur Road', 'Manvi Road'],
                'Bidar, Karnataka': ['Udgir Road', 'Humnabad Road', 'Basavakalyan Road', 'Aurad Road', 'Bhalki Road', 'Kamalnagar', 'Vijay Nagar', 'Shivaji Nagar'],
                'Hospet, Karnataka': ['Station Road', 'Hampi Road', 'Toranagallu', 'Kampli Road', 'Sandur Road', 'Bellary Road', 'Gandhi Nagar', 'Nehru Nagar'],
                'Hassan, Karnataka': ['BM Road', 'Vidyanagar', 'Salagame Road', 'Arsikere Road', 'Belur Road', 'Channarayapatna Road', 'Holenarasipura Road', 'Alur Road'],
                'Gadag, Karnataka': ['Station Road', 'Betgeri', 'Hulkoti', 'Shirhatti Road', 'Mundargi Road', 'Ron Road', 'Nargund Road', 'Lakshmeshwar Road'],
                'Udupi, Karnataka': ['Manipal', 'Karkala Road', 'Kundapura Road', 'Brahmavar Road', 'Kaup Road', 'Hebri Road', 'Byndoor Road', 'Santhekatte'],
                'Kolar, Karnataka': ['KGF Road', 'Bangarpet Road', 'Mulbagal Road', 'Srinivaspur Road', 'Malur Road', 'Robertsonpet', 'Champion Reefs', 'Oorgaum'],
                'Mandya, Karnataka': ['KRS Road', 'Mysore Road', 'Srirangapatna Road', 'Maddur Road', 'Malavalli Road', 'Pandavapura Road', 'Nagamangala Road', 'Krishnarajpet Road'],
                'Chikkamagaluru, Karnataka': ['MG Road', 'Kadur Road', 'Tarikere Road', 'Koppa Road', 'Sringeri Road', 'Mudigere Road', 'Balehonnur Road', 'Ajjampura Road'],
                'Chitradurga, Karnataka': ['Holalkere Road', 'Hiriyur Road', 'Challakere Road', 'Hosadurga Road', 'Molakalmuru Road', 'Bharamasagara Road', 'Davangere Road', 'Bellary Road']
            };
            
            return cityNeighborhoods[city] || ['City Center', 'Gandhi Nagar', 'Nehru Nagar', 'Vidyanagar', 'Shivaji Nagar', 'Station Road', 'MG Road', 'Jayanagar'];
        }
        
        // Generate demo reviews
        function generateDemoReviews() {
            const reviews = [
                { text: "Excellent service and great attention to detail. The barber really knew what he was doing!", author_name: "Mike Johnson" },
                { text: "Clean shop, friendly staff, and reasonable prices. Will definitely be back!", author_name: "David Smith" },
                { text: "Best haircut I've had in years. Highly recommend this place to anyone.", author_name: "Chris Wilson" },
                { text: "Professional atmosphere and skilled barbers. Great experience overall.", author_name: "Robert Brown" },
                { text: "Quick service without compromising quality. Perfect for busy schedules.", author_name: "James Davis" }
            ];
            
            return reviews.slice(0, Math.floor(Math.random() * 3) + 1);
        }
        
        // Helper functions for Leaflet implementation
        function getRandomPhotos() {
            const demoPhotos = [
                'https://images.unsplash.com/photo-1585747860715-2ba37e788b70?w=400&h=300&fit=crop',
                'https://images.unsplash.com/photo-1503951914875-452162b0f3f1?w=400&h=300&fit=crop',
                'https://images.unsplash.com/photo-1621605815971-fbc98d665033?w=400&h=300&fit=crop',
                'https://images.unsplash.com/photo-1560066984-138dadb4c035?w=400&h=300&fit=crop',
                'https://images.unsplash.com/photo-1599351431202-1e0f0137899a?w=400&h=300&fit=crop',
                'https://images.unsplash.com/photo-1634449571010-02389ed0f9b0?w=400&h=300&fit=crop',
                'https://images.unsplash.com/photo-1605497788044-5a32c7078486?w=400&h=300&fit=crop'
            ];
            
            const numPhotos = Math.floor(Math.random() * 3) + 2;
            return demoPhotos.slice(0, numPhotos).map(url => ({ getUrl: () => url }));
        }
        
        function generateRandomPhone() {
            return `(${Math.floor(Math.random() * 900) + 100}) ${Math.floor(Math.random() * 900) + 100}-${Math.floor(Math.random() * 9000) + 1000}`;
        }
        
        function displayStations() {
            const stationsList = document.getElementById('stationsList');
            stationsList.innerHTML = groomingStations.map((station, index) => {
                // Handle both old format (with getUrl) and new format (direct URLs)
                const photos = station.photos || [];
                const photoUrls = photos.map(photo => 
                    typeof photo === 'string' ? photo : (photo.getUrl ? photo.getUrl({ maxWidth: 400, maxHeight: 300 }) : photo)
                );
                
                // Use stationName or name for display
                const displayName = station.stationName || station.name;
                const displayLocation = station.address || station.location;
                
                return `
                    <div class="bg-white rounded-xl shadow-sm card-hover overflow-hidden">
                        ${photoUrls.length > 0 ? `
                            <div class="image-carousel" data-station-id="${station.id}">
                                ${photoUrls.map((url, photoIndex) => `
                                    <img src="${url}" alt="${displayName}" class="carousel-image ${photoIndex === 0 ? 'active' : ''}" loading="lazy">
                                `).join('')}
                                ${photoUrls.length > 1 ? `
                                    <button class="carousel-controls carousel-prev" onclick="previousImage(${index})">
                                        <i class="fas fa-chevron-left"></i>
                                    </button>
                                    <button class="carousel-controls carousel-next" onclick="nextImage(${index})">
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                ` : ''}
                                <!-- Station Name Overlay -->
                                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4">
                                    <h3 class="text-xl font-bold text-white">${displayName}</h3>
                                    <p class="text-white/90 text-sm">${station.ownerName || 'Professional Grooming'}</p>
                                </div>
                            </div>
                        ` : `
                            <div class="h-48 bg-gradient-to-br from-indigo-100 to-purple-100 flex items-center justify-center relative">
                                <i class="fas fa-cut text-4xl text-indigo-600"></i>
                                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4">
                                    <h3 class="text-xl font-bold text-white">${displayName}</h3>
                                    <p class="text-white/90 text-sm">${station.ownerName || 'Professional Grooming'}</p>
                                </div>
                            </div>
                        `}
                        
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-2">
                                ${station.opening_hours?.open_now ? 
                                    '<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-medium">Open Now</span>' : 
                                    '<span class="bg-red-100 text-red-800 px-2 py-1 rounded text-xs font-medium">Closed</span>'
                                }
                            </div>
                            <p class="text-gray-700 mb-3 text-sm leading-relaxed">
                                ${getStationDescription(station)}
                            </p>
                            <p class="text-gray-600 mb-2 flex items-center">
                                <i class="fas fa-map-marker-alt mr-2 text-indigo-600"></i>
                                ${displayLocation}
                            </p>
                            ${station.phone ? `
                                <p class="text-gray-600 mb-2 flex items-center">
                                    <i class="fas fa-phone mr-2 text-indigo-600"></i>
                                    ${station.phone}
                                </p>
                            ` : ''}
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center">
                                    <div class="flex text-yellow-400">
                                        ${generateStars(station.rating)}
                                    </div>
                                    <span class="ml-2 text-sm text-gray-600">${parseFloat(station.rating).toFixed(1)}</span>
                                    <span class="ml-1 text-sm text-gray-500">(${station.user_ratings_total})</span>
                                </div>
                                <div class="text-sm text-gray-500">
                                    ${getPriceLevel(station.price_level)}
                                </div>
                            </div>
                            
                            ${station.reviews && station.reviews.length > 0 ? `
                                <div class="mb-4 p-3 bg-gray-50 rounded-lg">
                                    <p class="text-sm text-gray-700 italic">"${station.reviews[0].text.substring(0, 100)}..."</p>
                                    <p class="text-xs text-gray-500 mt-1">- ${station.reviews[0].author_name}</p>
                                </div>
                            ` : ''}
                            
                            <div class="mb-4">
                                <div class="flex flex-wrap gap-1">
                                    ${station.features.map(feature => `
                                        <span class="bg-gray-100 text-gray-700 px-2 py-1 rounded text-xs">${getFeatureLabel(feature)}</span>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <p class="text-sm font-medium text-gray-700 mb-1">Services:</p>
                                <div class="flex flex-wrap gap-1">
                                    ${station.services.map(service => `
                                        <span class="bg-indigo-100 text-indigo-800 px-2 py-1 rounded text-xs">${getServiceLabel(service)}</span>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <button onclick="selectStation('${station.id}')" class="w-full bg-indigo-600 text-white py-2 rounded-md hover:bg-indigo-700 transition duration-300">
                                Book Now
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Initialize carousels
            initializeCarousels();
        }
        
        // Helper functions for labels
        function getStationDescription(station) {
            const descriptions = {
                'Royal Cuts & Grooming': 'Premium grooming experience with traditional techniques and modern amenities. Specializing in precision cuts and luxury beard treatments.',
                'Mysore Palace Salon': 'Elegant salon combining traditional Indian grooming with contemporary styling. Expert stylists trained in classical and modern techniques.',
                'Karnataka Kings Barber': 'Classic barbershop experience with skilled barbers offering traditional cuts, hot towel shaves, and premium grooming services.'
            };
            
            const stationName = station.stationName || station.name;
            return descriptions[stationName] || 'Professional grooming services with experienced stylists, quality products, and a comfortable atmosphere for all your grooming needs.';
        }
        
        function getFeatureLabel(feature) {
            const labels = {
                'wifi': 'WiFi',
                'parking': 'Parking',
                'premium-products': 'Premium Products',
                'massage-chairs': 'Massage Chairs'
            };
            return labels[feature] || feature;
        }
        
        function getServiceLabel(service) {
            const labels = {
                'haircut': 'Haircuts',
                'beard-trim': 'Beard Trimming',
                'styling': 'Hair Styling',
                'full-service': 'Full Service'
            };
            return labels[service] || service;
        }
        
        function generateStars(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            let stars = '';
            
            for (let i = 0; i < fullStars; i++) {
                stars += '★';
            }
            if (hasHalfStar) {
                stars += '☆';
            }
            while (stars.length < 5) {
                stars += '☆';
            }
            return stars;
        }
        
        function getPriceLevel(level) {
            const prices = ['Free', '$', '$$', '$$$', '$$$$'];
            return prices[level] || '$$';
        }
        
        function getRandomFeatures() {
            const allFeatures = ['WiFi', 'Parking', 'Premium Products', 'Experienced Staff', 'Walk-ins Welcome', 'Online Booking', 'Credit Cards', 'Wheelchair Accessible'];
            const numFeatures = Math.floor(Math.random() * 4) + 2;
            const shuffled = allFeatures.sort(() => 0.5 - Math.random());
            return shuffled.slice(0, numFeatures);
        }

        // Carousel functions
        function initializeCarousels() {
            groomingStations.forEach((station, index) => {
                if (station.photos && station.photos.length > 1) {
                    stationCarousels[index] = {
                        currentIndex: 0,
                        totalImages: station.photos.length,
                        autoSlideInterval: setInterval(() => {
                            nextImage(index);
                        }, 5000) // Auto-slide every 5 seconds
                    };
                }
            });
        }
        
        function nextImage(stationIndex) {
            const carousel = stationCarousels[stationIndex];
            if (!carousel) return;
            
            const images = document.querySelectorAll(`[data-station-id="${groomingStations[stationIndex].id}"] .carousel-image`);
            if (images.length === 0) return;
            
            images[carousel.currentIndex].classList.remove('active');
            carousel.currentIndex = (carousel.currentIndex + 1) % carousel.totalImages;
            images[carousel.currentIndex].classList.add('active');
        }
        
        function previousImage(stationIndex) {
            const carousel = stationCarousels[stationIndex];
            if (!carousel) return;
            
            const images = document.querySelectorAll(`[data-station-id="${groomingStations[stationIndex].id}"] .carousel-image`);
            if (images.length === 0) return;
            
            images[carousel.currentIndex].classList.remove('active');
            carousel.currentIndex = carousel.currentIndex === 0 ? carousel.totalImages - 1 : carousel.currentIndex - 1;
            images[carousel.currentIndex].classList.add('active');
        }
        
        // Location functions
        function useCurrentLocation() {
            if (!navigator.geolocation) {
                showNotification('Geolocation is not supported by this browser.', 'error');
                showDemoStations();
                return;
            }
            
            showLoadingStations();
            document.getElementById('locationStatus').classList.remove('hidden');
            document.getElementById('currentLocation').textContent = 'Getting your location...';
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    userLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    
                    // Try reverse geocoding if Google API is available
                    if (typeof google !== 'undefined' && google.maps) {
                        const geocoder = new google.maps.Geocoder();
                        geocoder.geocode({ location: userLocation }, (results, status) => {
                            if (status === 'OK' && results[0]) {
                                document.getElementById('currentLocation').textContent = `Searching near: ${results[0].formatted_address}`;
                            }
                        });
                    }
                    
                    searchNearbyStations();
                },
                (error) => {
                    hideLoadingStations();
                    showNotification('Unable to get your location. Showing demo stations instead.', 'info');
                    document.getElementById('locationStatus').classList.add('hidden');
                    showDemoStations();
                }
            );
        }
        
        // Search by selected city using Nominatim
        async function searchByCity() {
            const citySelect = document.getElementById('citySelect');
            const selectedCity = citySelect.value;
            
            if (!selectedCity) {
                showNotification('Please select a city.', 'error');
                return;
            }
            
            showLoadingStations();
            document.getElementById('locationStatus').classList.remove('hidden');
            document.getElementById('currentLocation').textContent = `Searching in: ${selectedCity}`;
            
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(selectedCity)}&limit=1`);
                const data = await response.json();
                
                if (data && data.length > 0) {
                    userLocation = {
                        lat: parseFloat(data[0].lat),
                        lng: parseFloat(data[0].lon)
                    };
                    searchNearbyStations();
                } else {
                    // Fallback to demo stations
                    showDemoStations();
                }
            } catch (error) {
                console.log('Nominatim geocoding error, showing demo stations');
                showDemoStations();
            }
        }
        
        async function searchByLocation() {
            const locationInput = document.getElementById('locationInput');
            const location = locationInput.value.trim();
            
            if (!location) {
                showNotification('Please enter a location.', 'error');
                return;
            }
            
            showLoadingStations();
            document.getElementById('locationStatus').classList.remove('hidden');
            document.getElementById('currentLocation').textContent = `Searching near: ${location}`;
            
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(location)}&limit=1`);
                const data = await response.json();
                
                if (data && data.length > 0) {
                    userLocation = {
                        lat: parseFloat(data[0].lat),
                        lng: parseFloat(data[0].lon)
                    };
                    searchNearbyStations();
                } else {
                    hideLoadingStations();
                    showNotification('Location not found. Please try a different search.', 'error');
                    document.getElementById('locationStatus').classList.add('hidden');
                }
            } catch (error) {
                hideLoadingStations();
                showNotification('Unable to search location. Please try again.', 'error');
                document.getElementById('locationStatus').classList.add('hidden');
            }
        }
        
        function showLoadingStations() {
            document.getElementById('loadingStations').classList.remove('hidden');
            document.getElementById('stationsList').innerHTML = '';
        }
        
        function hideLoadingStations() {
            document.getElementById('loadingStations').classList.add('hidden');
        }

        function selectStation(stationId) {
            if (!currentUser) {
                showAuthModal('login');
                return;
            }
            
            selectedStation = groomingStations.find(s => s.id === stationId);
            showBookingModal();
        }

        function showBookingModal() {
            document.getElementById('bookingModal').classList.remove('hidden');
            loadTimeSlots();
        }

        function hideBookingModal() {
            document.getElementById('bookingModal').classList.add('hidden');
            document.getElementById('bookingStep1').classList.remove('hidden');
            document.getElementById('bookingStep2').classList.add('hidden');
        }

        function loadTimeSlots() {
            const timeSlotsContainer = document.getElementById('timeSlots');
            const selectedDate = document.getElementById('bookingDate').value;
            
            // For demo, randomly make some slots unavailable
            const availableSlots = timeSlots.filter(() => Math.random() > 0.3);
            
            timeSlotsContainer.innerHTML = availableSlots.map(time => `
                <button class="booking-slot p-2 border rounded-md text-sm hover:bg-gray-50 transition duration-200" 
                        onclick="selectTimeSlot('${time}')">
                    ${time}
                </button>
            `).join('');
        }

        function selectTimeSlot(time) {
            // Remove previous selection
            document.querySelectorAll('.booking-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            
            // Select current slot
            event.target.classList.add('selected');
            selectedSlot = time;
            
            // Enable next button
            document.getElementById('nextToPayment').disabled = false;
        }

        function updateBookingDetails() {
            const service = document.getElementById('serviceSelect');
            const nextBtn = document.getElementById('nextToPayment');
            
            if (service.value && selectedSlot) {
                nextBtn.disabled = false;
            }
        }

        function showPaymentStep() {
            const service = document.getElementById('serviceSelect');
            const selectedOption = service.options[service.selectedIndex];
            const date = document.getElementById('bookingDate').value;
            
            // Find nearest available station for the selected service and time
            const availableStation = findNearestAvailableStation(service.value, date, selectedSlot);
            
            if (!availableStation) {
                showNotification('No available stations found for your selected time. Please try a different time slot.', 'error');
                return;
            }
            
            // Set the selected station
            selectedStation = availableStation;
            
            // Get station's price for the service
            const stationPrice = getStationPrice(availableStation, service.value);
            
            document.getElementById('selectedService').textContent = selectedOption.text;
            document.getElementById('selectedDateTime').textContent = `${date} at ${selectedSlot}`;
            document.getElementById('totalAmount').textContent = `$${stationPrice}`;
            
            document.getElementById('bookingStep1').classList.add('hidden');
            document.getElementById('bookingStep2').classList.remove('hidden');
            
            // Generate random NFT number
            document.getElementById('nftNumber').textContent = String(Math.floor(Math.random() * 999) + 1).padStart(3, '0');
        }

        function showBookingStep() {
            document.getElementById('bookingStep1').classList.remove('hidden');
            document.getElementById('bookingStep2').classList.add('hidden');
        }

        // Find nearest available station for booking
        function findNearestAvailableStation(serviceType, date, timeSlot) {
            // Filter stations that offer the requested service
            const availableStations = groomingStations.filter(station => {
                return station.services && station.services.includes(serviceType) && 
                       station.opening_hours && station.opening_hours.open_now;
            });
            
            if (availableStations.length === 0) {
                return null;
            }
            
            // For demo purposes, randomly select from available stations
            // In a real app, this would consider actual distance and availability
            const randomIndex = Math.floor(Math.random() * availableStations.length);
            return availableStations[randomIndex];
        }

        // Get station's price for a specific service
        function getStationPrice(station, serviceType) {
            // Station-specific pricing based on their tier and service
            const basePrices = {
                'haircut': 25,
                'beard-trim': 15,
                'full-service': 40,
                'styling': 30
            };
            
            const basePrice = basePrices[serviceType] || 25;
            const priceMultiplier = station.price_level || 2;
            
            // Adjust price based on station's price level (1-4)
            const adjustedPrice = Math.round(basePrice * (priceMultiplier * 0.8));
            
            return adjustedPrice;
        }

        function handlePaymentMethodChange(e) {
            const nftPreview = document.getElementById('nftPreview');
            if (e.target.value === 'hedera') {
                nftPreview.classList.remove('hidden');
            } else {
                nftPreview.classList.add('hidden');
            }
        }

        function confirmBooking() {
            const service = document.getElementById('serviceSelect');
            const selectedOption = service.options[service.selectedIndex];
            const date = document.getElementById('bookingDate').value;
            const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked');
            
            if (!paymentMethod) {
                alert('Please select a payment method');
                return;
            }
            
            if (!selectedStation) {
                showNotification('No station selected. Please try booking again.', 'error');
                return;
            }
            
            // Get the price from the displayed total amount
            const totalAmountText = document.getElementById('totalAmount').textContent;
            const amount = totalAmountText.replace('$', '');
            
            // Create booking
            const booking = {
                id: Date.now(),
                stationId: selectedStation.id,
                stationName: selectedStation.stationName || selectedStation.name,
                stationAddress: selectedStation.address || selectedStation.location,
                service: selectedOption.text,
                date: date,
                time: selectedSlot,
                amount: amount,
                paymentMethod: paymentMethod.value,
                status: 'confirmed',
                createdAt: new Date().toISOString()
            };
            
            bookings.push(booking);
            localStorage.setItem('slotchain_bookings', JSON.stringify(bookings));
            
            // Create NFT if paid with crypto
            if (paymentMethod.value === 'hedera') {
                const nft = {
                    id: Date.now(),
                    number: document.getElementById('nftNumber').textContent,
                    service: service.value,
                    date: date,
                    rarity: Math.random() > 0.7 ? 'rare' : 'common',
                    createdAt: new Date().toISOString()
                };
                nftCollection.push(nft);
                localStorage.setItem('slotchain_nfts', JSON.stringify(nftCollection));
            }
            
            hideBookingModal();
            showNotification(`Booking confirmed at ${selectedStation.stationName || selectedStation.name}! Check your dashboard for details.`);
            
            // Send email notification (simulated)
            setTimeout(() => {
                showNotification('Confirmation email sent!', 'info');
            }, 2000);
        }

        function showDashboard() {
            document.getElementById('mainContent').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            loadDashboardData();
        }

        function showMainContent() {
            document.getElementById('mainContent').classList.remove('hidden');
            document.getElementById('dashboard').classList.add('hidden');
        }

        function loadDashboardData() {
            loadUpcomingBookings();
            loadBookingHistory();
            loadNFTCollection();
        }

        function loadUpcomingBookings() {
            const container = document.getElementById('upcomingBookings');
            const upcoming = bookings.filter(b => new Date(b.date) >= new Date()).slice(0, 3);
            
            if (upcoming.length === 0) {
                container.innerHTML = '<p class="text-gray-500">No upcoming appointments</p>';
                return;
            }
            
            container.innerHTML = upcoming.map(booking => `
                <div class="border rounded-lg p-4 flex justify-between items-center">
                    <div>
                        <h4 class="font-semibold">${booking.service}</h4>
                        <p class="text-gray-600">${booking.stationName}</p>
                        ${booking.stationAddress ? `<p class="text-xs text-gray-500">${booking.stationAddress}</p>` : ''}
                        <p class="text-sm text-gray-500">${booking.date} at ${booking.time}</p>
                    </div>
                    <div class="text-right">
                        <div class="text-lg font-semibold">$${booking.amount}</div>
                        <div class="text-sm text-green-600">${booking.status}</div>
                    </div>
                </div>
            `).join('');
        }

        function loadBookingHistory() {
            const container = document.getElementById('bookingHistory');
            const history = bookings.slice(-5).reverse();
            
            if (history.length === 0) {
                container.innerHTML = '<p class="text-gray-500">No booking history</p>';
                return;
            }
            
            container.innerHTML = history.map(booking => `
                <div class="border rounded-lg p-4 flex justify-between items-center">
                    <div>
                        <h4 class="font-semibold">${booking.service}</h4>
                        <p class="text-gray-600">${booking.stationName}</p>
                        ${booking.stationAddress ? `<p class="text-xs text-gray-500">${booking.stationAddress}</p>` : ''}
                        <p class="text-sm text-gray-500">${booking.date} at ${booking.time}</p>
                    </div>
                    <div class="text-right">
                        <div class="text-lg font-semibold">$${booking.amount}</div>
                        <div class="text-sm ${booking.paymentMethod === 'hedera' ? 'text-indigo-600' : 'text-gray-600'}">
                            ${booking.paymentMethod === 'hedera' ? 'HBAR' : 'Card'}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadNFTCollection() {
            const container = document.getElementById('nftCollection');
            
            if (nftCollection.length === 0) {
                container.innerHTML = `
                    <div class="col-span-2 text-center py-8">
                        <div class="w-16 h-16 bg-gradient-to-br from-purple-400 to-indigo-500 rounded-xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                            <i class="fas fa-gem text-white text-2xl"></i>
                        </div>
                        <p class="text-gray-500 font-medium">No NFTs collected yet</p>
                        <p class="text-sm text-gray-400 mt-1">Pay with HBAR to earn exclusive NFTs!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = nftCollection.map(nft => `
                <div class="bg-gradient-to-br from-purple-50 to-indigo-50 dark:from-purple-900/20 dark:to-indigo-900/20 rounded-xl p-4 text-center border border-purple-200 dark:border-purple-700 shadow-sm hover:shadow-md transition-all duration-300 hover:scale-105">
                    <div class="w-16 h-16 bg-gradient-to-br from-orange-400 to-purple-500 rounded-xl flex items-center justify-center mx-auto mb-3 shadow-lg nft-shimmer">
                        <i class="fas fa-cut text-white text-xl"></i>
                    </div>
                    <div class="text-lg font-bold text-gray-900 dark:text-white mb-1">#${nft.number}</div>
                    <div class="text-xs font-medium text-purple-600 dark:text-purple-400 uppercase tracking-wide mb-1">${nft.rarity}</div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">${nft.service}</div>
                    <div class="text-xs text-gray-400 dark:text-gray-500 mt-1">${new Date(nft.date).toLocaleDateString()}</div>
                </div>
            `).join('');
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const text = document.getElementById('notificationText');
            
            text.textContent = message;
            let bgColor = 'bg-green-500';
            if (type === 'error') bgColor = 'bg-red-500';
            else if (type === 'info') bgColor = 'bg-blue-500';
            
            notification.className = `notification ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 7000);
        }

        function closeNotification() {
            document.getElementById('notification').classList.remove('show');
        }

        // Station Setup Functions
        function showStationSetupModal() {
            document.getElementById('stationSetupModal').classList.remove('hidden');
        }

        function hideStationSetupModal() {
            document.getElementById('stationSetupModal').classList.add('hidden');
            document.getElementById('stationSetupForm').reset();
        }

        function handleStationSetup(e) {
            e.preventDefault();
            
            // Collect form data
            const formData = {
                id: `station_${Date.now()}`,
                stationName: document.getElementById('stationName').value,
                ownerName: document.getElementById('ownerName').value,
                address: document.getElementById('stationAddress').value,
                phone: document.getElementById('stationPhone').value,
                email: document.getElementById('stationEmail').value,
                walletAddress: document.getElementById('walletAddress').value,
                services: Array.from(document.querySelectorAll('.service-checkbox:checked')).map(cb => cb.value),
                features: Array.from(document.querySelectorAll('.feature-checkbox:checked')).map(cb => cb.value),
                rating: (Math.random() * 1.5 + 3.5).toFixed(1),
                user_ratings_total: Math.floor(Math.random() * 100) + 20,
                price_level: Math.floor(Math.random() * 3) + 1,
                photos: [
                    'https://images.unsplash.com/photo-1585747860715-2ba37e788b70?w=400&h=300&fit=crop',
                    'https://images.unsplash.com/photo-1503951914875-452162b0f3f1?w=400&h=300&fit=crop'
                ],
                reviews: [
                    { text: "Great new addition to the SlotChain network!", author_name: "Customer Review" }
                ],
                opening_hours: { open_now: true },
                submittedAt: new Date().toISOString(),
                status: 'approved' // Auto-approve for demo
            };
            
            // Store application (in real app, this would be sent to server)
            let stationApplications = JSON.parse(localStorage.getItem('slotchain_station_applications') || '[]');
            stationApplications.push(formData);
            localStorage.setItem('slotchain_station_applications', JSON.stringify(stationApplications));
            
            hideStationSetupModal();
            showNotification('Station setup submitted successfully! Your station is now live on SlotChain.');
            
            // Auto-refresh the stations list
            showAvailableStations();
        }



        // Chatbot Functions
        function toggleChatbot() {
            const window = document.getElementById('chatbotWindow');
            chatbotOpen = !chatbotOpen;
            window.style.display = chatbotOpen ? 'flex' : 'none';
        }

        function closeChatbot() {
            document.getElementById('chatbotWindow').style.display = 'none';
            chatbotOpen = false;
        }

        async function sendChatMessage() {
            const input = document.getElementById('chatbotInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addChatMessage(message, 'user');
            input.value = '';
            
            // Show typing indicator
            showTypingIndicator();
            
            try {
                // Call Perplexity API
                const response = await fetch(PERPLEXITY_API_URL, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${PERPLEXITY_API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'llama-3.1-sonar-small-128k-online',
                        messages: [
                            {
                                role: 'system',
                                content: 'You are a helpful assistant for SlotChain, a grooming station booking platform. Help users with booking questions, payment info (we accept Hedera HBAR crypto and traditional cards), NFT rewards, and general platform questions. Keep responses concise and friendly.'
                            },
                            {
                                role: 'user',
                                content: message
                            }
                        ],
                        max_tokens: 150,
                        temperature: 0.7
                    })
                });

                const data = await response.json();
                hideTypingIndicator();
                
                if (data.choices && data.choices[0]) {
                    addChatMessage(data.choices[0].message.content, 'bot');
                } else {
                    addChatMessage('I apologize, but I\'m having trouble connecting right now. Please try again later or contact our support team.', 'bot');
                }
            } catch (error) {
                hideTypingIndicator();
                // Fallback responses for common questions
                const fallbackResponse = getFallbackResponse(message);
                addChatMessage(fallbackResponse, 'bot');
            }
        }

        function getFallbackResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('book') || lowerMessage.includes('appointment')) {
                return 'To book an appointment, click "Book Now" on any grooming station or use the main "Book Now" button. You\'ll need to create an account first if you haven\'t already!';
            } else if (lowerMessage.includes('payment') || lowerMessage.includes('pay')) {
                return 'We accept both Hedera HBAR cryptocurrency and traditional credit/debit cards. When you pay with HBAR, you\'ll receive an exclusive NFT as a reward!';
            } else if (lowerMessage.includes('nft') || lowerMessage.includes('crypto')) {
                return 'Pay with Hedera HBAR to earn exclusive SlotChain NFTs! Each booking paid with crypto gives you a unique collectible token that you can view in your dashboard.';
            } else if (lowerMessage.includes('cancel') || lowerMessage.includes('reschedule')) {
                return 'You can view and manage your bookings from your dashboard. Click on your name in the top right and select "Dashboard" to see your appointments.';
            } else {
                return 'I\'m here to help with SlotChain bookings! You can ask me about making appointments, payment methods, NFT rewards, or managing your bookings. What would you like to know?';
            }
        }

        function addChatMessage(message, sender) {
            const messagesContainer = document.getElementById('chatbotMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.textContent = message;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'block';
            const messagesContainer = document.getElementById('chatbotMessages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        // Initialize on page load
        window.addEventListener('load', function() {
            // Simulate some demo data for first-time users
            if (bookings.length === 0 && currentUser) {
                // Add some sample bookings for demo
                const sampleBookings = [
                    {
                        id: 1,
                        stationId: 1,
                        stationName: 'Premium Cuts Downtown',
                        service: 'Haircut - $25',
                        date: '2024-01-15',
                        time: '14:00',
                        amount: '25',
                        paymentMethod: 'hedera',
                        status: 'completed',
                        createdAt: '2024-01-10T10:00:00Z'
                    }
                ];
                
                const sampleNFTs = [
                    {
                        id: 1,
                        number: '001',
                        service: 'haircut',
                        date: '2024-01-15',
                        rarity: 'rare',
                        createdAt: '2024-01-15T14:00:00Z'
                    }
                ];
                
                localStorage.setItem('slotchain_bookings', JSON.stringify(sampleBookings));
                localStorage.setItem('slotchain_nfts', JSON.stringify(sampleNFTs));
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96968208d7fb937f',t:'MTc1NDIzMTM3NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
